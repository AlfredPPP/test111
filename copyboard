import pandas as pd
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from models import MyTable, Base  # 你的 ORM 定义

# 1. 读取 Excel
df = pd.read_excel("data.xlsx")

# 2. 创建数据库连接
engine = create_engine("sqlite:///my_database.db")
Session = sessionmaker(bind=engine)
session = Session()

# 3. 遍历 DataFrame，构造 ORM 对象
records = []
for _, row in df.iterrows():
    # 只传入 ORM 模型里定义的字段
    data = {col: row[col] for col in df.columns if hasattr(MyTable, col)}
    obj = MyTable(**data)
    records.append(obj)

# 4. 批量插入
session.add_all(records)
session.commit()
session.close()